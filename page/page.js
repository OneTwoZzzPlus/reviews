"use strict";(()=>{var M="\u041E\u0442\u0437\u044B\u0432\u044B \u0430\u0433\u0440\u0435\u0433\u0438\u0440\u043E\u0432\u0430\u043D\u044B \u0438\u0437 \u043E\u0442\u043A\u0440\u044B\u0442\u044B\u0445 \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A\u043E\u0432",N="\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C...",h="<br/>(\u043E\u0431\u043D\u043E\u0432\u0438\u0442\u0435 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043D\u0438\u0435)",E="\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0445\u043E\u0442\u044F \u0431\u044B 3 \u0441\u0438\u043C\u0432\u043E\u043B\u0430 =]",H='<span class="error">\u041D\u0435 \u043F\u043E\u043D\u044F\u0442\u043D\u043E, \u0447\u0442\u043E \u044D\u0442\u043E \u0442\u0430\u043A\u043E\u0435 :|</span>'+h,T="\u041E\u0442\u0437\u044B\u0432\u044B \u043F\u0440\u0438\u0448\u043B\u0438 \u0441\u043B\u043E\u043C\u0430\u043D\u043D\u044B\u0435 =("+h,S="\u0420\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u044B \u043F\u0440\u0438\u0448\u043B\u0438 \u0441\u043B\u043E\u043C\u0430\u043D\u043D\u044B\u0435 =("+h;function w(e){switch(e){case 0:return'<span class="error">\u0421\u0435\u0440\u0432\u0435\u0440 \u0441 \u043E\u0442\u0437\u044B\u0432\u0430\u043C\u0438 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D =(</span>';case 401:return"\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0432\u043E\u0439\u0434\u0438\u0442\u0435, \u044D\u0442\u043E \u0431\u044B\u0441\u0442\u0440\u043E =)";case 404:return"\u041E\u0442\u0437\u044B\u0432\u044B \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0442 \\(O_o)/";default:return`\u0421\u0435\u0440\u0432\u0435\u0440 \u043F\u0440\u0438\u0441\u043B\u0430\u043B "${e}" \u0432\u043C\u0435\u0441\u0442\u043E \u043E\u0442\u0437\u044B\u0432\u043E\u0432 =(`}}function k(e){switch(e){case 0:return'<span class="error">\u0421\u0435\u0440\u0432\u0435\u0440 \u0441 \u043E\u0442\u0437\u044B\u0432\u0430\u043C\u0438 \u043D\u0435\u0434\u043E\u0441\u0442\u0443\u043F\u0435\u043D =(</span>';case 401:return"\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0432\u043E\u0439\u0434\u0438\u0442\u0435, \u044D\u0442\u043E \u0431\u044B\u0441\u0442\u0440\u043E =)";case 404:return"\u041D\u0438\u0447\u0435\u0433\u043E \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u043E \\(O_o)/";default:return`\u0421\u0435\u0440\u0432\u0435\u0440 \u043F\u0440\u0438\u0441\u043B\u0430\u043B "${e}" \u0432\u043C\u0435\u0441\u0442\u043E \u0440\u0435\u0437\u0443\u043B\u044C\u0442\u0430\u0442\u043E\u0432 \u043F\u043E\u0438\u0441\u043A\u0430 =(`}}function v(e){if(!e)return-1/0;let t=e.match(/(\d{2}):(\d{2})\s+(\d{2})\.(\d{2})\.(\d{4})/);if(!t)return-1/0;let[,n,r,s,a,o]=t;return new Date(Number(o),Number(a)-1,Number(s),Number(n),Number(r)).getTime()}var j=null;async function p(e,t,n={},r=null){let s=new URL(t,"https://reviews.work.gd/"),a={method:e.toUpperCase(),headers:{"Content-Type":"application/json"},signal:r?.signal};return j&&(a.headers.token=j),a.method==="GET"?Object.entries(n).forEach(([o,u])=>{s.searchParams.set(o,u.toString())}):a.body=JSON.stringify(n),new Promise((o,u)=>{fetch(s,a).then(async c=>{if(c.ok){console.log("[API] fetch resolved");let d=await c.text();o(d?JSON.parse(d):{})}else{let d=await c.json().catch(()=>({}));c.status===401||c.status===404?console.info("[API] error details:",d):console.error("[API] error details:",d),u(c.status)}}).catch(c=>{c.name!=="AbortError"?(console.error("[API] network error:",c),u(0)):console.log("[API] fetch aborted")})})}async function I(e,t){return console.log(`[API] send /search for "${e}"`),await p("GET","/search",{query:e},t)}async function P(e){return console.log(`[API] send /teacher for "${e}"`),await p("GET",`/teacher/${e}`,{})}async function R(e){return console.log(`[API] send /subject for "${e}"`),await p("GET",`/subject/${e}`,{})}async function O(e,t){return console.log(`[API] send /teacher/${e}/rate ${t}`),await p("POST",`/teacher/${e}/rate`,{user_rating:t})}async function x(e,t){return console.log(`[API] send /comment/${e}/vote ${t}`),await p("POST",`/comment/${e}/vote`,{user_karma:t})}function L(e){let t=document.createElement("div");t.classList.add("comments-wrap");let n=B(e);if(e.length>1){let r=z(e);r.addEventListener("change",s=>{let a=parseInt(s.target.value);console.log(`[UI] sorting model ${a}`);let o=B(e,a);t.replaceChild(o,n),n=o}),t.appendChild(r)}return t.appendChild(n),t}function B(e,t=0){let n=document.createElement("div");return n.classList.add("comments"),F(e,t).map(s=>n.append(V(s))),n}function V(e){let t=document.createElement("div");return t.classList.add("comment"),t.innerHTML=`
        <div class="comment-head">
            \u041E\u0442\u0437\u044B\u0432 ${e.date}
            ${e?.subject?` \u043F\u043E \u043F\u0440\u0435\u0434\u043C\u0435\u0442\u0443 "${e.subject.title}"`:" "}
            ${e?.source?` \u0438\u0441\u0442\u043E\u0447\u043D\u0438\u043A "<a href="${e.source.link??""}">${e.source.title}</a>"`:""}
        </div>
        <div>${e.text}</div>
    `,t.appendChild(W(e.id,e.karma,e.user_karma)),t}function W(e,t,n){let r=document.createElement("div");r.classList.add("karma");let s=document.createElement("span");s.classList.add("karma-value");let a=document.createElement("button");a.classList.add("karma-btn");let o=document.createElement("button");return o.classList.add("karma-btn"),a.addEventListener("click",async u=>{let c=await x(e,n===1?0:1);n=c.user_karma,t=c.karma,g(s,a,o,t,n)}),o.addEventListener("click",async u=>{let c=await x(e,n===-1?0:-1);n=c.user_karma,t=c.karma,g(s,a,o,t,n)}),g(s,a,o,t,n),r.appendChild(a),r.appendChild(s),r.appendChild(o),r}function g(e,t,n,r,s){s==null&&(s=0),e.innerHTML=r,t.innerHTML=s===1?"\u25B2":"\u25B3",n.innerHTML=s===-1?"\u25BC":"\u25BD"}function z(){let e=document.createElement("select");return e.name="sort",e.classList.add("comments-dropdown"),e.innerHTML=`
        <option value="0">C \u0432\u044B\u0441\u043E\u043A\u043E\u0439 \u043A\u0430\u0440\u043C\u044B</option>
        <option value="1">\u0421 \u043D\u0438\u0437\u043A\u043E\u0439 \u043A\u0430\u0440\u043C\u044B</option>
        <option value="2">\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u043D\u043E\u0432\u044B\u0435</option>
        <option value="3">\u0421\u043D\u0430\u0447\u0430\u043B\u0430 \u0441\u0442\u0430\u0440\u044B\u0435</option>`,e}function F(e,t=0){return[...e].sort((n,r)=>{let s=v(n.date),a=v(r.date),o;switch(t){case 0:return o=r.karma-n.karma,o===0?Number.isNaN(s)||Number.isNaN(a)?0:a-s:o;case 1:return o=n.karma-r.karma,o===0?Number.isNaN(s)||Number.isNaN(a)?0:a-s:o;case 2:return Number.isNaN(s)||Number.isNaN(a)?0:a-s;case 3:return Number.isNaN(s)||Number.isNaN(a)?0:s-a;default:return 0}})}function b(e,t,n){let r=document.createElement("div");return r.classList.add("rating-box"),r.innerHTML=J(e,t,n),r.addEventListener("change",async s=>{if(s.target.name===`rating-${e}`){let a=parseInt(s.target.value),o=await O(e,a);r.innerHTML=J(e,o.rating,o.user_rating)}}),r}function J(e,t,n){n==null&&(n=0);let r=[5,4,3,2,1].map(s=>`
        <input type="radio" id="rate-${e}-${s}" name="rating-${e}" value="${s}" ${n===s?"checked":""}>
        <label for="rate-${e}-${s}">\u2605</label>
    `).join("");return`
        <div class="rating-row">
            <span class="rating-title">\u0421\u0440\u0435\u0434\u043D\u044F\u044F \u043E\u0446\u0435\u043D\u043A\u0430:</span>
            <span class="rating-value">${t}</span>
        </div>
        <div class="rating-row">
            <span class="rating-title">\u0412\u0430\u0448\u0430 \u043E\u0446\u0435\u043D\u043A\u0430:</span>
            <div class="rating">${r}</div>
        </div>
    `}function y(e){let t=e.map(r=>`
        <div class="summary">
            <span class="summary-title">${r.title??""}</span>: 
            <span class="summary-value">${r.value??""}</span>
        </div>
    `).join(""),n=document.createElement("div");return n.classList.add("summaries"),n.innerHTML=t,n}function m(e){if(!e||!Array.isArray(e.summaries)||!Array.isArray(e.comments)||e.summaries.length===0&&e.comments.length===0)return null;let t=document.createElement("div");return t.classList.add("reviews-content-box"),t.appendChild(b(e.id,e.rating,e?.user_rating)),e.summaries.length!==0&&t.appendChild(y(e.summaries)),e.comments.length!==0&&t.appendChild(L(e.comments)),t}var f=document.createElement("p");f.classList.add("note");f.innerHTML=M;function D(e){let t=m(e);if(t===null)return null;let n=document.createElement("div");return n.innerHTML=`<h2>${e.name}</h2>`,n.appendChild(t),n.appendChild(f),n}function q(e){if(!e||!Array.isArray(e.teachers))return null;e.teachers.sort((r,s)=>{let a=s.rating-r.rating;return a===0?s.id-r.id:a});let t=e.teachers.map(r=>m(r));if(t.some(r=>r===null))return null;let n=document.createElement("div");return n.innerHTML=`<h2>${e.title}</h2>`,e.teachers.forEach((r,s)=>{let a=document.createElement("div");a.innerHTML=`<h3>${r.name}</h3>`,a.appendChild(t[s]),n.appendChild(a)}),n.appendChild(f),n}function G(e,t){let n=document.createElement("div");return n.className="search-list",e.results.forEach(r=>{let s=document.createElement("div");s.className="search-item",s.innerHTML=`
            ${r.title}
            <span class="search-id">${r.id}</span>
        `,s.addEventListener("click",async()=>t(r.id,r.type)),n.appendChild(s)}),n}var Q,i,l,$,U,C;function K(){i=document.querySelector("#reviews-status-box"),Q=document.querySelector("#reviews-isu-box"),l=document.querySelector("#reviews-container"),$=document.querySelector("#reviews-input"),$.addEventListener("input",()=>{clearTimeout(U),U=setTimeout(X,300)})}async function X(){let e=$.value.trim();if(e){if(e.length<3){i.innerHTML=E;return}}else{i.innerHTML="";return}i.innerHTML=N,C?.abort(),C=new AbortController,I(e,C).then(t=>{let n=G(t,Y);n?(i.innerHTML="",l.innerHTML="",l.appendChild(n)):(l.innerHTML="",i.innerHTML=S)}).catch(t=>{l.innerHTML="",i.innerHTML=k(t)})}async function Y(e,t){switch(t){case"teacher":P(e).then(n=>{let r=D(n);r!==null?(l.innerHTML="",l.appendChild(r)):i.innerHTML=T}).catch(n=>{i.innerHTML=w(n)});break;case"subject":R(e).then(n=>{let r=q(n);r!==null?(l.innerHTML="",l.appendChild(r)):i.innerHTML=T}).catch(n=>{i.innerHTML=w(n)});break;default:console.error(`\u041D\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043D\u044B\u0439 type ${t}`),i.innerHTML=H}}document.addEventListener("DOMContentLoaded",Z);async function Z(){K()}})();
//# sourceMappingURL=page.js.map
